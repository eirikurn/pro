#!/usr/bin/env node

/**
 * Module dependencies.
 */

var prototyper = require('../')
  , pathUtils = require('path')
  , program = require('commander');

/**
 * Option parsing
 */
program
  .version(prototyper.version)
  .option('-d, --dir [dir]', 'Directory containing the prototype sources', ".")
  .option('-l, --log [level]', 'Controls how verbose the logs will be, can be debug, info, warn and error', 'info')
  .option('-o, --output [dir]', 'Output directory for static web content', "_build")
  .parse(process.argv);

// Host and port
var host = '0.0.0.0'
  , port = program.args.pop() || '8080'

if (~port.indexOf(':')) {
  port = port.split(':');
  host = port[0];
  port = port[1];
}

/**
 * Provide default env variables based on command line arguments.
 */
var env = process.env;
env.PRO_SOURCE = env.PRO_SOURCE || pathUtils.resolve(program.dir);
env.PRO_TARGET = env.PRO_TARGET || pathUtils.resolve(program.output);
env.PRO_BASE_URL = env.PRO_BASE_URL || "http://" + host + ":" + port;
env.PRO_LOG_LEVEL = env.PRO_LOG_LEVEL || program.log;

/**
 * Start prototyper
 */
prototyper.start();
